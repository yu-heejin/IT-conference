**플라이웨이로 DB 형상 관리 시작하기**

DB 스키마 변경을 수작업으로 하고 있는 모든 개발자를 위해

DB 수동 반영 문제점

1. 서로 다른 환경에서 통일된 스키마를 가지기 위해 너무 많은 리소스가 소요된다.
    1. 로컬, 개발, 운영 등 환경이 달라질 때마다 매번 반복되는 변경 작업
2. 100% 신뢰할 수 있는 유효성 검증이 불가능하다
    1. 하이버네이트에서는 validate 기능을 제공하고 있지만 제약 존재

DB 스키마를 코드로 관리한다! -> 플라이웨이

1. 스키마 변경 이력이 남는다.
    1. 문제 발생 시 파악할 범위를 좁힐 수 있다.
    2. 변경 이력의 존재 유무에 따라 크게 달라지는 문제 해결의 난이도
2. 스키마 변경 작업이 안전해진다.
    1. 반복되는 작업에서 발생할 수 있는 휴먼 에러ㅜ감소
3. 환경 구축과 협업이 편리해진다.
    1. 변경 이력이 코드로 남게 되므로 리뷰가 편리햊ㄴ
    2. 마이그레이션이 자동화되기 때문에 스키마를 통일하기 쉬워진다.

자바 진영 대표적 라이브러리 플라이웨이와 리퀴베이스

친절한 공식 문서, 풍부한 레퍼런스

리퀴베이스의 다양한 기능이 그다지 필요하지 않은 환경

Flyway 동작 방식

1. 빈 데이터베이스에 연동
    1. 스키마 히스토리 테이블을 찾고, 없으면 새로 만든다.
    2. 클래스 패스를 스캔해서 작업할 마이그레이션 파일을 하나 찾는다. (가장 낮은 버전부터 수행)

플라이웨이는 선형적으로 버전 관리를 한다.

테이블 구조

버전은 낮은 순서부터 차례로 실행하며, 테이블에 쌓이는 구조를 가진다.

쳌섬은 파일 내용을 해싱한 값으로, 마이그레이션 파일의 유효성을 검증한다.

파일 내용이 달라지면 해당 값도 달라진다

석세스는 작성된 쿼리의 실행 성공 여부를 저장한다.

해당 값에 따라 스크립트 실행 여부를 판단

새로운 변경 작업은 항상 최신 버전보다 높은 숫자로 작성

이미 적용된 마이그레이션 파일을 수정하거나 삭제하면 안된다

실무 적용시 고려할 점

마이그레이션 파일은 계속 쌓이기 때문에 프로젝트가 오래될수록 양이 늘어난다

배포 일자가 정해져있다면 일자별 관리도 유용하다

오랜 기간 지나서 변경할 필요 없는 경우 하나로 묶는 방법

H2 임베디드 모드에서는 오류가 날 수 있으니 주의

앱을 일단 끄고 빌드한 후에 다시 켜서 사용

실무에서 MySQL로도 형상 관리가 가능하다

총 27개의 DBMS 에 대한 지원을 하고 있다.
