**카카오 테크 미트**

- 이벤트 드리븐 아키텍처
- 사용자의 광고 클릭 로그 수집
- Upsert(update insert)를 활용한 멱등성 컨슈머(mongodb는 없음)
- 이벤트 드리븐, 파이프라인을 만들 때,,,
    - 멱등성, 트랜잭션 프로듀서
    - 유니크, 업서트, wal 컨슈머
- 스마트 메시지 서비스
    - 몽고에 실시간으로 들어오는 데이터를 처리 -> 텀블링 윈도우 단위로 묶어서 일정 주가로 모델링

——————————

폭증하는 카카오톡 트래픽에 대처하는 방법

- 메시지 전송 트래픽 초당 62만건,,
- 그러나 신년이 되면 새해 인사 트래픽 폭증, 지진과 같은 자연재해, 월드컵 등의 행사가 있으면 난리남
1. 자동 대응 시스템
- 백그라운드 로그인
    - 전달받은 사용자가 전달받지 못한 경우 fcm 푸시 등을 수행
    - 푸시를 받은 모바일은 폰이 켜지면서 로그인 연결 요청 -> 카카오를 키면 로그인 없이 바로 접속(사용자 편의성 극대)
- 경주 지진 2016년 -> 백그라운드 로그인 기능 때문이었음
    - 재난 안내문자가 전국민에게 안내 -> 모바일이 깨어남 -> 백그라운드 로그인 수행 -> 카카오톡 서버 접속 시도 -> 전국민이 백그라운드 로그인 시도
    - 메세지 서버로 들어오는 경우의 대부분이 로그인 요청이었음
    - 요청 스레드 수 증가 -> 활성화된 스레드 수를 이용해서 트래픽 폭증을 인지하면 어떨까?
- 부하레벨이 올라가면 백그라운드 로그인같이 당장 처리할 필요가 없는 경우는 차단 -> 빠르게 실패처리를 하더라도 필요없는 프로토콜의 유입을 막고 중요한 것만
- 포항 지진때 테스트한 결과
1. 교통 관리 시스템 구축
- 새해에 꺠어있기 때문에 백그라운드가 아니라 막을 수 있는 방법이 없음 -> 자동대응 시스템 불가능
- 로그인 트래픽 폭증 -> 일부 메세지 전송 불가 상태가 됨
- 따라서 요청별 전용 도로를 만드는 것이 어떠한가?
    - 로그인 요청이 오래 걸리기 때문에 로그인이 아무리 많이 들어와도 한계가 있도록
    - 로그인 요청이 모든 스레드를 점유하지 않도록
- > 월드컵 트래픽 (조규성 동점골)
- 교통관리 시스템으로 장애를 방지함
- 당장의 필요한 트래픽만 처리하는 것이 중요하다
- 자원을 요청별로 배분하여 특정 요청이 점유하지 않게 ㅎ야한다.
- 트래픽 처리를 위해 아직 개선할 여지는 많다.

———————————————

지도 이미지와 음성을 활용한 어뷰징 방지 전략

DKAPTCHA

- 악성 봇 트래픽 30프로
- 3건 중의 1건은 정상적인 로그인이 아님 -> 무차별 대입 공격
- Okta는 2022년 1분기에 100억건 이상의 계정 탈취 시도
- 카카오에서 자체적으로 만든 captcha
- 봇인지 사람인지 판단하는 captcha 기술의 일종
- 시중에 나온 것들은 니즈에 맞지 않기 떄문에 니즈에 맞는 캡차 기술이 필요하다.
- 지도데이터로 캡차를 만든다. -> 카카오가 만든 지도 데이터를 재사용, 재생성하여 캡차 기술 개발
- 음성 개발은 우리가 직접 왜곡하여 만든다.

DKAPTCHA 매커니즘

- 지도 이미지에 POI 등과 같은 지명 데이터를 넣고 봇에 인식을 저해할 수 있는 흰색 글씨를 넣음(워터마크)
- 여러 OCR 모델을 이용해서 detection (인식이 잘되는지 판단)
- 인식률 검사 -> 평가 결과로 사용할지 말지 판단
- 사용자에게 친숙하지만 봇에겐 어려운 퀴즐 ㄹ 만등어서 적용

사용자 사용성에 대한 고민

- 미국 성인 19퍼센트가 캡차를 만났을 때 온라인 거래를 중단한다.
- pinch를 할용한 이미지 확대 기능(이미지 확대, 축소, 이동 등) -> 이미 가지고있는 경험들을 캡차에 전달
- 사용자가 유추할 수 있는 데이터를 제공
- 사용자에게 친숙한 경험을 제공하도록 개발!

향후 발전 사항

- ML을 통한 퀴즈 고도화
- 존재하지 않는 지명을 퀴즈에 집어넣음
- 캡차 사용자 데이터 구축 -> 정상 유저 행동 패턴 구분

—————————————————

재난 안전문자가 메시지로 전송되는데 왜 카카오톡이 꺠어나는가?

- 재난 문자가 가더라도 편의성을 위해 카카오톡이 연결되도록 요청됨…

전체 서비스를 위해서 요청별로 스레드 수를 제한한다.

카프카 테스트 팁

내부적으로 카프카 공용 클러스터를 사용하고 있음

기본적으로 비즈니스로직으로 풀어나가려고한다.

비정상 사용자 판별과 OTP

카카오 서버의 트래픽 관리 비결, 코틀린 마이그레이션

- 구조 개선으로 트래픽 처리
- 코어서버 C++ -> 개고생, 코틀린으로 넘어갈 수밖에…
- C++ 개발자다 보니까 코틀린을 새로 익혀야하고 문법을 익혀야하는지 고민을 해야한다.
- 카톡 기능 짱 많아서 많은 것을 했어야함

봇의 POI 인식률 낮추기

봇은 띄어쓰기를 좀 부정확하게 판단한다. -> 지명에 대한 인식률을 저하시킬 수 있음

이미지 경계를 흐릿하게 하거나 하지만 사용자에게 친숙하게 할 수 없음

카프카 도입 시점

카프카는 정확히 말하면 메시지 큐가 아님!!! 분산 이벤트 스트리밍 플랫폼임

많은 메세지 큐와 이벤트 처리를 제공하지만 캎카처럼 안정적인 서비스를 제공하지 않음

만약 메세지 큐가 아니라 이벤트 데이터 처리가 필요하다면 카프카 기술을 통해 해결할 수 있는지 파악하고 도입하는 것이 필요하다.

대용량 트래픽을 어떻게 예상하고 테스트하는가?

예측하기 쉬운 이벤트 등은 당연히 예상하기 쉬움 -> 미흡한 점은 없는지 검토

예측하지 못한 이벤트(지진, 재해 등)는 겪으면서 알게됨 -> 이러한 패턴을 분석하여 새로운 시스템을 세울지 고민

특정 지표를 통해 백그라운드 로그인인지 그냥 로그인인지 구분하는 방법이 있음

모든 요청을 다 처리하지 못함 -> 그래서 특정 요청에 대한 장애로 이어지는 건 맞지만 잠깐의 실패처리로 순차적으로 처리하면 사람들이 잠깐 버벅이는 정도로 느꼈을 것임

리드커미티드, 리드언커미티드

C++ 성능적 이슈를 견딜 수 있는 언어가 코틀린 (**마이그레이션 시 성능이 그대로 나오는가?**)

2PC 카프카는 지원안함

필요한 로그인이란..? -> 사용자가 직접 켜서 로그인하는 경우, 차단하면 안되고 반드시 성공시켜야함

카프카가 자체적으로 보안을 제공하진 않고, 어뷰징이 발생한 경우 어뷰징을 막는 로직이 앞단에 넣고하기 위해서 카프카로 오기 전에 어뷰징을 막고자함

메세지 수신 시 입력이 지연되는 경우 -> iOS 클라이언트 문제니 cs로 넣어주세요..

캡차 음성왜곡: 음성 왜곡은 굉장히 쉽게 뚫림(STT기술), 음성 왜곡은 지금 음성에 다양한 종류를 섞어서 다른 오답을 도출하기 위해서 다양한 오답을 심음
